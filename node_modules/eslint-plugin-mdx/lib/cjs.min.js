"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),r=require("eslint/package.json"),t=require("eslint-mdx"),n=require("eslint/lib/rules/no-unused-expressions"),s=require("path"),i=require("vfile"),o=require("cosmiconfig"),a=require("remark-mdx"),u=require("remark-parse"),c=require("remark-stringify"),l=require("unified");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=f(n),d=f(s),m=f(i),g=f(a),x=f(u),v=f(c),h=f(l),y={parser:"eslint-mdx",plugins:["mdx"],processor:"mdx/remark"},_={parserOptions:{ecmaFeatures:{impliedStrict:!0}},rules:{"eol-last":"off","no-undef":"off","no-unused-expressions":"off","no-unused-vars":"off","padded-blocks":"off",strict:"off","unicode-bom":"off"}},k=e.__assign(e.__assign({},y),{globals:{React:"readonly"},rules:{"lines-between-class-members":0,"react/jsx-no-undef":[2,{allowGlobals:!0}],"react/react-in-jsx-scope":0}}),b=+r.version.split(".").slice(0,2).join("."),j=e.__assign(e.__assign({},y),{rules:{"mdx/no-jsx-html-comments":2,"mdx/no-unused-expressions":2,"mdx/remark":1,"no-unused-expressions":0}});if(b>=6.4){var S=[{files:"*.mdx",extends:"plugin:mdx/overrides"},{files:"**/*.{md,mdx}/**",extends:"plugin:mdx/code-blocks"}];try{require.resolve("prettier"),require.resolve("eslint-plugin-prettier"),S.push({files:"*.md",rules:{"prettier/prettier":[2,{parser:"markdown"}]}})}catch(e){}Object.assign(j,{overrides:S})}var q,E={base:y,"code-blocks":_,codeBlocks:_,overrides:k,recommended:j},O={meta:{type:"problem",docs:{description:"Forbid invalid html style comments in jsx block",category:"SyntaxError",recommended:!0},messages:{jsxHtmlComments:"html style comments are invalid in jsx: {{ origin }}"},fixable:"code"},create:function(e){return{ExpressionStatement:function(r){var n=e.parserServices.JSXElementsWithHTMLComments;if(t.isJsxNode(r.expression)&&"Program"===r.parent.type&&n&&0!==n.length){var s=n.shift();if(!s.data.inline)for(var i=function(t,n,s){e.report({messageId:"jsxHtmlComments",data:{origin:s},loc:n,node:r,fix:function(e){return e.replaceTextRange([n.start.offset,n.end.offset],t)}})},o=0,a=s.data.comments;o<a.length;o++){var u=a[o];i(u.fixed,u.loc,u.origin)}}}}}},w=e.__assign(e.__assign({},p.default),{create:function(e){var r=p.default.create(e);return{ExpressionStatement:function(e){t.isJsxNode(e.expression)&&"Program"===e.parent.type||r.ExpressionStatement(e)}}}}),A=function(e,r,t){t&&/^\.\.?([/\\]|$)/.test(e)&&(e=d.default.resolve(d.default.dirname(t),e)),r=r.endsWith("-")?r:r+"-";for(var n,s=0,i=[e,e.startsWith("@")?e.replace("/","/"+r):r+e];s<i.length;s++){var o=i[s];try{return require(o)}catch(e){n||(n=e)}}throw n},I=h.default().use(x.default).freeze(),C=function(r,n){var s;q||(q=o.cosmiconfigSync("remark",{packageProp:"remarkConfig"}).search);try{s=q(r)}catch(e){if("ENOTDIR"!==e.code||!/[/\\]\d+_[^/\\]*\.[\da-z]+$/i.test(r))throw e;try{s=q(d.default.dirname(r))}catch(r){throw e}}var i=(null==s?void 0:s.config)||{},a=i.plugins,u=void 0===a?[]:a,c=i.settings;try{u.push([require.resolve("remark-lint-file-extension"),!1])}catch(e){}var l=I().use({settings:c}).use(v.default);return n&&l.use(g.default),u.reduce((function(r,n){var i=t.arrayify(n),o=i[0],a=i.slice(1);return r.use.apply(r,e.__spreadArray(["string"==typeof o?A(o,"remark",s.filepath):o],a))}),l).freeze()},L={meta:{type:"layout",docs:{description:"Linter integration with remark plugins",category:"Stylistic Issues",recommended:!0},fixable:"code"},create:function(r){var n=r.getFilename(),s=d.default.extname(n),i=r.getSourceCode(),o=r.parserOptions,a=t.DEFAULT_EXTENSIONS.concat(o.extensions||[]).includes(s),u=t.MARKDOWN_EXTENSIONS.concat(o.markdownExtensions||[]).includes(s);return{Program:function(t){if(a||u){var s=i.getText(t),o=C(n,a),c=m.default({path:n,contents:s});try{o.processSync(c)}catch(e){c.messages.includes(e)||(c.message(e).fatal=!0)}for(var l=function(n,i,a,u,c,l){var f=u?2:null==u?0:1;if(!f)return"continue";var p={reason:i,source:n,ruleId:a,severity:f};r.report({message:JSON.stringify(p),loc:{start:e.__assign(e.__assign({},c),{column:c.column-1}),end:e.__assign(e.__assign({},l),{column:l.column-1})},node:t,fix:function(e){if(null==c.offset)return null;var r=[c.offset,null==l.offset?c.offset+1:l.offset],t=s.slice.apply(s,r),n=o.processSync(t).toString();return e.replaceTextRange(r,t.endsWith("\n")?n:n.slice(0,-1))}})},f=0,p=c.messages;f<p.length;f++){var d=p[f],g=d.source,x=d.reason,v=d.ruleId,h=d.fatal,y=d.location;l(g,x,v,h,y.start,y.end)}}}}}},M={"no-jsx-html-comments":O,"no-unused-expressions":w,noJsxHtmlComments:O,noUnusedExpressions:w,remark:L},N=new Set(["eol-last","unicode-bom"]),T={};function P(e,r,t){if(r[e.type]&&r[e.type](e,t),void 0!==e.children)for(var n=e,s=0,i=n.children;s<i.length;s++){P(i[s],r,n)}}function J(e){var r="\x3c!--",t="--\x3e";if(e.slice(0,r.length)!==r||e.slice(-t.length)!==t)return"";var n=e.slice(r.length,-t.length);return/^(eslint\b|global\s)/u.test(n.trim())?n:""}var R=/^[>\s]*/u;function F(e){return e.position.start.offset-e.position.start.column+1}function H(e,r){return R.exec(e.slice(F(r)))[0]}function U(e,r,t){for(var n=F(r),s=e.slice(n,r.position.end.offset).split("\n"),i=H(e,r).length,o=[{js:0,md:0}],a=t.reduce((function(e,r){return e+r.length+1}),0),u=n+s[0].length+1,c=0;c+1<s.length;c++){var l=s[c+1],f=R.exec(l)[0].length,p=Math.min(i,f);o.push({js:a,md:u+p-a}),u+=l.length+1,a+=l.length-p+1}return o}function W(e){return e&&!N.has(e.ruleId)}var B={preprocess:function(r,t){var n=I.parse(r),s=[];return T[t]=s,P(n,{code:function(t,n){var i=[];if(t.lang){for(var o=n.children.indexOf(t)-1,a=n.children[o];a&&"html"===a.type;){var u=J(a.value);if(!u)break;if("eslint-skip"===u.trim())return;i.unshift("/*"+u+"*/"),o--,a=n.children[o]}s.push(e.__assign(e.__assign({},t),{baseIndentText:H(r,t),comments:i,rangeMap:U(r,t,i)}))}}}),s.map((function(r,t){return{filename:t+"."+r.lang,text:e.__spreadArray(e.__spreadArray([],r.comments),[r.value,""]).join("\n")}}))},postprocess:function(r,t){var n,s=T[t]||[];return(n=[]).concat.apply(n,r.map((function(r,t){var n=s[t];if(!n)return r;var i=function(r){var t=r.comments.reduce((function(e,r){return e+r.split("\n").length}),0),n=r.position.start.line;return function(s){var i=s.line-t;if(i<1)return null;var o={line:i+n,column:s.column+r.position.indent[i-1]-1};Number.isInteger(s.endLine)&&(o.endLine=s.endLine-t+n);var a={};return s.fix&&(a.fix={range:s.fix.range.map((function(e){for(var t=1;t<r.rangeMap.length&&r.rangeMap[t].js<=e;)t++;return e+r.rangeMap[t-1].md})),text:s.fix.text.replace(/\n/gu,"\n"+r.baseIndentText)}),e.__assign(e.__assign(e.__assign({},s),o),a)}}(n);return r.map(i).filter(W)})))},supportsAutofix:!0},D={javascript:"js",javascriptreact:"jsx",typescript:"ts",typescriptreact:"tsx",markdown:"md",mdown:"md",mkdn:"md"};function G(r,n){var s=t.last(r.split("."));if(!1===n)return s;n=e.__assign(e.__assign({},D),n);var i=s.toLowerCase();return n[s]||n[i]||i}var z={},X=Object.keys(require.cache).find((function(e){return/([/\\])eslint\1lib(?:\1linter){2}\.js$/.test(e)}));if(!X)throw new Error("Could not find ESLint Linter in require cache");var $=require(X).Linter,K=$.prototype.verify;$.prototype.verify=function(e,r,t){var n=r&&("function"==typeof r.extractConfig?r.extractConfig(void 0===t||"string"==typeof t?t:t.filename):r).settings||{};return z.lintCodeBlocks=!0===n["mdx/code-blocks"],z.languageMapper=n["mdx/language-mapper"],K.call(this,e,r,t)};var Q={supportsAutofix:!0,preprocess:function(r,t){return z.lintCodeBlocks?e.__spreadArray(e.__spreadArray([],B.preprocess(r,t).map((function(e){var r=e.text,t=e.filename;return{text:r,filename:t.slice(0,t.lastIndexOf("."))+"."+G(t,z.languageMapper)}}))),[r]):[r]},postprocess:function(r,t){return B.postprocess(r,t).map((function(r){var t=r.message,n=r.ruleId,s=r.severity;if("mdx/remark"!==n)return r;var i=JSON.parse(t),o=i.source,a=i.ruleId,u=i.reason,c=i.severity;return e.__assign(e.__assign({},r),{ruleId:o+"-"+a,message:u,severity:Math.max(s,c)})}))}},V={markdown:B,remark:Q};exports.DEFAULT_LANGUAGE_MAPPER=D,exports.base=y,exports.codeBlocks=_,exports.configs=E,exports.getGlobals=function(e,r){return void 0===r&&(r={}),(Array.isArray(e)?e:Object.keys(e)).reduce((function(e,r){var t;return Object.assign(e,((t={})[r]=!1,t))}),r)},exports.getRemarkProcessor=C,exports.getShortLang=G,exports.noJsxHtmlComments=O,exports.noUnusedExpressions=w,exports.overrides=k,exports.processorOptions=z,exports.processors=V,exports.recommended=j,exports.remark=L,exports.remarkProcessor=I,exports.requirePkg=A,exports.rules=M;
